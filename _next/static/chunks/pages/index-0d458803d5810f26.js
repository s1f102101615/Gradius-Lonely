(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{9208:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(2088)}])},2088:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=s(5893),r=s(24),n=s(185),u=s.n(n),o=s(7294),i=s(2237),l=s(8239),d=s(1290),c=s(5371);let y=(e,t)=>{switch(t){case"0":return(()=>{let t=[],s=Math.floor(241*Math.random())+120;for(let e=0;e<5;e++){let a={x:640+50*e,y:s,speedX:-120,monster:0,status:-.5*e};t.push(a)}return[...e,...t]})();case"1":return(()=>{let t=[],s=Math.floor(241*Math.random());for(let e=0;e<2;e++){let a={x:640,y:s+240*e,speedX:-110,monster:1,status:0};t.push(a)}return[...e,...t]})();default:return e}},p=(e,t,s,a)=>e.map(e=>{switch(e.monster){case 0:return{...e,status:"paused"===t?e.status:e.status+s,x:e.x+("paused"===t?0:e.status+s>=3&&e.status+s<=3.7||e.status+s>=5&&e.status+s<=7||e.status+s>=7?-e.speedX*s:e.speedX*s),y:e.y+("paused"===t?0:e.status+s>=3&&e.status+s<=3.7||e.status+s>=5&&e.status+s<=7?-60*s:0)};case 1:return{...e,status:"paused"===t?e.status:e.status+s,x:e.x+("paused"===t?0:e.speedX*s),y:e.status+s>=2.5?e.y+("paused"===t?0:e.y-a[0]-20>=0?-35*s:35*s):e.y};default:return{...e}}}).filter(e=>e.x>0),f=()=>{let[e]=(0,r.KO)(c.L),[t,s]=(0,o.useState)([0,0]),[n,f]=(0,o.useState)([]),[m,x]=(0,o.useState)(),[h,w]=(0,o.useState)([0,0]),[b,v]=(0,o.useState)([]),[k,g]=(0,o.useState)(!1),[S,N]=(0,o.useState)(!1),[E,j]=(0,o.useState)(!1),[X,_]=(0,o.useState)(!1),[O,A]=(0,o.useState)(!1),[J,L]=(0,o.useState)(0),C=(0,o.useRef)(null),I=e=>{switch(e.code){case"ArrowUp":g(!0);break;case"ArrowDown":N(!0);break;case"ArrowLeft":j(!0);break;case"ArrowRight":_(!0);break;case"KeyZ":A(!0)}},M=e=>{switch(e.code){case"ArrowUp":g(!1);break;case"ArrowDown":N(!1);break;case"ArrowLeft":j(!1);break;case"ArrowRight":_(!1);break;case"KeyZ":A(!1)}};function D(e,t){let s=e.x-t.x,a=e.y-t.y;return 32.5>=Math.sqrt(s*s+a*a)}let K=()=>{f(e=>e.filter(e=>{let t=b.some(t=>D(t,e));return!t||(v(t=>t.filter(t=>!D(t,e))),!1)}))},R=async()=>{let e=await d.x.rooms.get();x(e.body),w(e.body.nowtime),v(JSON.parse(e.body.bullet)),f(JSON.parse(e.body.enemy)),s(e.body.myposition),v(e=>e.map(e=>({...e,speedX:1e3})))};(0,o.useEffect)(()=>{R()},[]),(0,o.useEffect)(()=>{let e=h[0],s=h[1],a=setInterval(()=>{(null==m?void 0:m.status)==="started"&&(w([e+1,s]),console.log(e),m.scenario&&Number(m.scenario[s])===e&&(console.log(m.scenario[s+1]),f(e=>y(e,m.scenario[s+1])),w([e=0,s+2])))},1e3),r=setInterval(async()=>{await d.x.rooms.post({body:{status:"paused",nowtime:h,myposition:t,bullet:JSON.stringify(b),enemy:JSON.stringify(n)}})},1e3);return()=>{clearInterval(r),clearInterval(a)}},[m,h]),(0,o.useEffect)(()=>{let e=new(u()).Animation(e=>{if(e){let a=e.timeDiff/1e3;if((null==m?void 0:m.status)==="started"){let e=t;e[0]=t[0]+(k?-3:0)+(S?3:0),e[1]=t[1]+(E?-3:0)+(X?3:0),s(e),L(J+a),O&&J>.3&&(v(e=>[...e,{x:t[1]+54,y:t[0]+20,speedX:1e3}]),L(0))}v(e=>e.map(e=>({...e,x:e.x+e.speedX*a,speedX:(null==m?void 0:m.status)==="paused"?0:e.speedX})).filter(e=>e.x<640)),f(e=>p(e,null==m?void 0:m.status,a,t)),K()}});return e.start(),C.current=e,()=>{e.stop()}},[b,n,k,S,E,X,t]),(0,o.useEffect)(()=>(document.addEventListener("keydown",I),document.addEventListener("keyup",M),()=>{document.removeEventListener("keydown",I),document.removeEventListener("keyup",M)}),[]);let U=async()=>{await d.x.rooms.post({body:{status:"paused",nowtime:h,myposition:t,bullet:JSON.stringify(b),enemy:JSON.stringify(n)}}),R(),console.log("pause")},P=async()=>{await d.x.rooms.post({body:{status:"started",nowtime:h,myposition:t,bullet:JSON.stringify(b),enemy:JSON.stringify(n)}}),R(),console.log("start")};return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["gradius",t]}),(0,a.jsx)("div",{tabIndex:0,style:{display:"inline-block",border:"solid"},children:(0,a.jsx)(i.Hf,{width:640,height:480,children:(0,a.jsxs)(i.mh,{children:[(0,a.jsx)(i.UL,{x:t[1],y:t[0],width:50,height:40,fill:"blue"}),n.map((e,t)=>(0,a.jsx)(i.Cd,{x:e.x,y:e.y,radius:20,fill:1===e.monster?"pink":"red"},t)),b.map((e,t)=>(0,a.jsx)(i.Cd,{x:e.x,y:e.y,radius:10,fill:"green"},t))]})})}),(0,a.jsx)("div",{onClick:U,children:"pause"}),(0,a.jsx)("div",{onClick:P,children:"start"}),(0,a.jsxs)("div",{children:[h[0],"ç§’",h[1]/2,"wave"]})]}):(0,a.jsx)(l.g,{visible:!0})};var m=f}},function(e){e.O(0,[237,774,888,179],function(){return e(e.s=9208)}),_N_E=e.O()}]);