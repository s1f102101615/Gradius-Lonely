(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{9208:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(2088)}])},2088:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(5893),n=s(24),o=s(185),i=s.n(o),l=s(7294),r=s(2237),u=s(8239),d=s(1290),y=s(5371);let c=(e,t)=>"0"===t?(()=>{let t=[],s=Math.floor(481*Math.random());for(let e=0;e<5;e++){let a={x:640+50*e,y:s,speedX:-120,monster:0,status:-.5*e};t.push(a)}return[...e,...t]})():e,p=(e,t,s)=>e.map(e=>({...e,status:"paused"===t?e.status:e.status+s,x:e.x+("paused"===t?0:e.status+s>=3&&e.status+s<=3.7||e.status+s>=5&&e.status+s<=7||e.status+s>=7?-e.speedX*s:e.speedX*s),y:e.y+("paused"===t?0:e.status+s>=3&&e.status+s<=3.7||e.status+s>=5&&e.status+s<=7?-60*s:0)})).filter(e=>e.x>0),f=()=>{let[e]=(0,n.KO)(y.L),[t,s]=(0,l.useState)([0,0]),[o,f]=(0,l.useState)([]),[x,m]=(0,l.useState)(),[h,b]=(0,l.useState)([0,0]),[g,w]=(0,l.useState)([]),v=(0,l.useRef)(null),N=async e=>{if((null==x?void 0:x.status)==="paused")return;if("KeyZ"===e.code){let e={x:t[1]+54,y:t[0]+20,speedX:1e3};w(t=>[...t,e])}else if("Space"===e.code){let e={x:640,y:Math.floor(481*Math.random()),speedX:-120,monster:0,status:0};f(t=>[...t,e])}let a=await d.x.control.post({body:{x:t[0],y:t[1],KeyEvent:e.code}});s([a.body.x,a.body.y])};function S(e,t){let s=e.x-t.x,a=e.y-t.y;return 32.5>=Math.sqrt(s*s+a*a)}let X=()=>{f(e=>e.filter(e=>{let t=g.some(t=>S(t,e));return!t||(w(t=>t.filter(t=>!S(t,e))),!1)}))},_=async()=>{let e=await d.x.rooms.get();m(e.body),b(e.body.nowtime),w(JSON.parse(e.body.bullet)),f(JSON.parse(e.body.enemy)),s(e.body.myposition),w(e=>e.map(e=>({...e,speedX:1e3}))),f(e=>e.map(e=>({...e,speedX:-100})))};(0,l.useEffect)(()=>{_()},[]),(0,l.useEffect)(()=>{let e=h[0],t=h[1],s=setInterval(()=>{(null==x?void 0:x.status)==="started"&&(b([e+1,t]),console.log(e),x.scenario&&Number(x.scenario[t])===e&&(console.log(x.scenario[t+1]),f(e=>c(e,x.scenario[t+1])),b([e=0,t+2])))},1e3);return()=>{clearInterval(s)}},[x,h]),(0,l.useEffect)(()=>{let e=new(i()).Animation(e=>{if(e){let t=e.timeDiff/1e3;w(e=>e.map(e=>({...e,x:e.x+e.speedX*t,speedX:(null==x?void 0:x.status)==="paused"?0:e.speedX})).filter(e=>e.x<640)),f(e=>p(e,null==x?void 0:x.status,t)),X()}});return e.start(),v.current=e,()=>{e.stop()}},[g,o]);let j=async()=>{await d.x.rooms.post({body:{status:"paused",nowtime:h,myposition:t,bullet:JSON.stringify(g),enemy:JSON.stringify(o)}}),_(),console.log("pause")},E=async()=>{await d.x.rooms.post({body:{status:"started",nowtime:h,myposition:t,bullet:JSON.stringify(g),enemy:JSON.stringify(o)}}),_(),console.log("start")};return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["gradius",t]}),(0,a.jsx)("div",{tabIndex:0,onKeyDown:N,style:{display:"inline-block",border:"solid"},children:(0,a.jsx)(r.Hf,{width:640,height:480,children:(0,a.jsxs)(r.mh,{children:[(0,a.jsx)(r.UL,{x:t[1],y:t[0],width:50,height:40,fill:"blue"}),o.map((e,t)=>(0,a.jsx)(r.Cd,{x:e.x,y:e.y,radius:20,fill:"red"},t)),g.map((e,t)=>(0,a.jsx)(r.Cd,{x:e.x,y:e.y,radius:10,fill:"green"},t))]})})}),(0,a.jsx)("div",{onClick:j,children:"pause"}),(0,a.jsx)("div",{onClick:E,children:"start"})]}):(0,a.jsx)(u.g,{visible:!0})};var x=f}},function(e){e.O(0,[237,774,888,179],function(){return e(e.s=9208)}),_N_E=e.O()}]);